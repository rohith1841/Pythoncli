<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Binance Futures Testnet Bot</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" />
  <link rel="stylesheet" href="/static/style.css" />
</head>
<body>
<div class="container py-4">
  <h1 class="mb-3">Binance Futures Testnet Bot</h1>
  <p class="text-muted">Place MARKET, LIMIT, STOP-LIMIT, OCO, or TWAP orders.</p>

  <form id="order-form" class="card p-3 mb-4">
    <div class="row g-3">
      <div class="col-md-6">
        <label class="form-label">API Key</label>
        <input class="form-control" name="api_key" required />
      </div>
      <div class="col-md-6">
        <label class="form-label">API Secret</label>
        <input class="form-control" name="api_secret" required />
      </div>
      <div class="col-md-4">
        <label class="form-label">Symbol</label>
        <input class="form-control" name="symbol" placeholder="BTCUSDT" required />
      </div>
      <div class="col-md-4">
        <label class="form-label">Side</label>
        <select class="form-select" name="side">
          <option>BUY</option>
          <option>SELL</option>
        </select>
      </div>
      <div class="col-md-4">
        <label class="form-label">Order Type</label>
        <select class="form-select" name="order_type" id="order_type">
          <option>MARKET</option>
          <option>LIMIT</option>
          <option>STOP_LIMIT</option>
          <option>OCO</option>
          <option>TWAP</option>
        </select>
      </div>

      <!-- Common fields -->
      <div class="col-md-4 common-field">
        <label class="form-label">Quantity</label>
        <input class="form-control" name="quantity" placeholder="e.g., 0.01" />
      </div>

      <!-- Limit fields -->
      <div class="col-md-4 type-LIMIT d-none">
        <label class="form-label">Limit Price</label>
        <input class="form-control" name="price" placeholder="e.g., 65000" />
      </div>

      <!-- Stop-Limit fields -->
      <div class="col-md-4 type-STOP_LIMIT d-none">
        <label class="form-label">Stop Price</label>
        <input class="form-control" name="stop_price" placeholder="e.g., 64000" />
      </div>
      <div class="col-md-4 type-STOP_LIMIT d-none">
        <label class="form-label">Limit Price</label>
        <input class="form-control" name="limit_price" placeholder="e.g., 63900" />
      </div>

      <!-- OCO fields -->
      <div class="col-md-4 type-OCO d-none">
        <label class="form-label">Take Profit Price</label>
        <input class="form-control" name="take_profit_price" placeholder="e.g., 66000" />
      </div>
      <div class="col-md-4 type-OCO d-none">
        <label class="form-label">Stop Price</label>
        <input class="form-control" name="stop_price" placeholder="e.g., 64000" />
      </div>
      <div class="col-md-4 type-OCO d-none">
        <label class="form-label">Stop-Limit Price</label>
        <input class="form-control" name="stop_limit_price" placeholder="e.g., 63900" />
      </div>

      <!-- TWAP fields -->
      <div class="col-md-4 type-TWAP d-none">
        <label class="form-label">Total Quantity</label>
        <input class="form-control" name="total_qty" placeholder="e.g., 0.1" />
      </div>
      <div class="col-md-4 type-TWAP d-none">
        <label class="form-label">Splits</label>
        <input class="form-control" name="splits" placeholder="e.g., 5" />
      </div>
      <div class="col-md-4 type-TWAP d-none">
        <label class="form-label">Interval (sec)</label>
        <input class="form-control" name="interval_sec" placeholder="e.g., 10" />
      </div>

    </div>
    <div class="mt-3">
      <button class="btn btn-primary" type="submit">Place Order</button>
    </div>
  </form>

  <div class="row g-3">
    <div class="col-md-6">
      <div class="card p-3">
        <h5>Response</h5>
        <pre id="response" class="bg-light p-2 small"></pre>
      </div>
    </div>
    <div class="col-md-6">
      <div class="card p-3">
        <h5>bot.log (tail)</h5>
        <pre id="logs" class="bg-light p-2 small"></pre>
      </div>
    </div>
  </div>
</div>

<script>
  const orderType = document.getElementById('order_type');
  function updateFields() {
    const val = orderType.value;
    document.querySelectorAll('[class^="type-"]').forEach(el => el.classList.add('d-none'));
    document.querySelectorAll('.type-' + val).forEach(el => el.classList.remove('d-none'));
    // Quantity is used by MARKET/LIMIT/STOP_LIMIT/OCO; TWAP uses total_qty
    document.querySelectorAll('.common-field').forEach(el => {
      el.classList.toggle('d-none', val === 'TWAP');
    });
  }
  orderType.addEventListener('change', updateFields);
  updateFields();

  // Submit form via fetch
  document.getElementById('order-form').addEventListener('submit', async (e) => {
    e.preventDefault();
    const fd = new FormData(e.target);
    const resp = await fetch('/place_order', { method: 'POST', body: fd });
    const json = await resp.json();
    document.getElementById('response').textContent = JSON.stringify(json, null, 2);
    loadLogs();
  });

  async function loadLogs() {
    const r = await fetch('/logs');
    const j = await r.json();
    document.getElementById('logs').textContent = (j.lines || []).join('\n');
  }
  loadLogs();
  setInterval(loadLogs, 5000);
</script>

</body>
</html>

